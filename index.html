<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Afrowrld on Telegram</title>
    <link rel="stylesheet" href="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.css" type="text/css"/>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #1a1f3a;
            --bg-card: #1e2442;
            --bg-card-hover: #252b4a;
            --accent-primary: #a855f7;
            --accent-secondary: #7c3aed;
            --accent-gradient: linear-gradient(135deg, #a855f7, #7c3aed);
            --text-primary: #ffffff;
            --text-secondary: #9ca3c3;
            --text-muted: #6b7194;
            --border-color: #2d3454;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.4);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);
            --shadow-glow: 0 0 20px rgba(168, 85, 247, 0.3);
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            -webkit-tap-highlight-color: transparent; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
        }
        
        body { 
            background: var(--bg-primary); 
            color: var(--text-primary); 
            overflow-x: hidden; 
            height: 100vh; 
            width: 100vw; 
        }

        /* --- Animations --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .slide-in { animation: slideIn 0.4s ease-out forwards; }

        /* --- Global UI --- */
        button { cursor: pointer; }
        
        header {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 16px 20px; 
            background: var(--bg-secondary); 
            position: sticky; 
            top: 0; 
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }
        
        .logo { 
            font-weight: 900; 
            font-size: 1.5rem; 
            letter-spacing: -0.5px; 
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .icon-btn { 
            background: var(--bg-card); 
            border: 1px solid var(--border-color); 
            padding: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all 0.3s;
        }
        .icon-btn:hover { 
            background: var(--bg-card-hover); 
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-glow);
        }
        .icon-btn svg { 
            width: 22px; 
            height: 22px; 
            stroke: var(--text-secondary); 
            stroke-width: 2; 
            fill: none; 
        }

        .nav-bar { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            padding: 16px 20px; 
            background: var(--bg-primary); 
            border-bottom: 1px solid var(--border-color);
        }
        
        .back-link { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-weight: 600; 
            color: var(--text-secondary); 
            border: none; 
            background: none; 
            font-size: 15px;
            transition: color 0.3s;
        }
        .back-link:hover { color: var(--accent-primary); }
        .back-link svg { 
            width: 20px; 
            height: 20px; 
            stroke: currentColor; 
            stroke-width: 2.5; 
            fill: none; 
        }

        /* --- Inputs & Forms --- */
        .admin-form { 
            display: flex; 
            flex-direction: column; 
            gap: 18px; 
            max-width: 420px; 
            margin: 20px auto; 
            padding: 30px; 
            background: var(--bg-card); 
            border-radius: var(--radius-lg); 
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }
        
        .input-group { position: relative; width: 100%; }
        
        .input-label { 
            font-size: 13px; 
            font-weight: 600; 
            color: var(--text-secondary); 
            margin-bottom: 8px; 
            display: block; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, select, textarea { 
            width: 100%; 
            padding: 14px 16px; 
            background: var(--bg-secondary); 
            border: 1px solid var(--border-color); 
            border-radius: var(--radius-md); 
            outline: none; 
            transition: all 0.3s; 
            font-size: 15px; 
            color: var(--text-primary); 
        }
        input:focus, select:focus, textarea:focus { 
            border-color: var(--accent-primary); 
            background: var(--bg-primary);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }
        textarea { resize: vertical; min-height: 100px; }
        
        .password-toggle { 
            position: absolute; 
            right: 15px; 
            top: 50%; 
            transform: translateY(-50%); 
            background: none; 
            border: none; 
            padding: 0; 
            cursor: pointer; 
            color: var(--text-muted);
            transition: color 0.3s;
        }
        .password-toggle:hover { color: var(--accent-primary); }
        
        .btn-primary { 
            background: var(--accent-gradient); 
            color: white; 
            border: none; 
            padding: 14px 28px; 
            border-radius: var(--radius-md); 
            font-weight: 700; 
            font-size: 15px; 
            cursor: pointer; 
            width: 100%; 
            box-shadow: var(--shadow-glow);
            transition: all 0.3s; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.5);
        }
        .btn-primary:active { transform: translateY(0); }
        
        .btn-outline { 
            background: transparent; 
            border: 2px solid var(--border-color); 
            color: var(--text-primary); 
            margin-top: 10px; 
            box-shadow: none; 
        }
        .btn-outline:hover { 
            border-color: var(--accent-primary);
            background: rgba(168, 85, 247, 0.1);
        }

        /* --- Custom Popup --- */
        #custom-popup {
            position: fixed; 
            inset: 0; 
            z-index: 9000; 
            background: rgba(10, 14, 39, 0.8);
            backdrop-filter: blur(8px);
            display: none; 
            align-items: center; 
            justify-content: center; 
            padding: 20px;
        }
        
        .popup-card {
            background: var(--bg-card); 
            padding: 30px; 
            border-radius: var(--radius-lg);
            width: 100%; 
            max-width: 340px; 
            text-align: center;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .popup-icon svg { width: 56px; height: 56px; margin-bottom: 20px; }
        .popup-title { font-weight: 800; font-size: 20px; margin-bottom: 10px; }
        .popup-msg { color: var(--text-secondary); font-size: 14px; margin-bottom: 24px; line-height: 1.5; }
        .popup-actions { display: flex; gap: 12px; justify-content: center; }

        /* --- Views --- */
        .view { display: none; padding-bottom: 60px; }
        .view.active { display: block; }
        .container { padding: 0 20px; }

        /* --- Dashboard & Stats --- */
        .stats-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 14px; 
            margin-bottom: 24px; 
        }
        
        .stat-card { 
            background: var(--bg-card); 
            padding: 20px; 
            border-radius: var(--radius-lg); 
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            text-align: center;
            transition: all 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent-primary);
        }
        
        .stat-num { 
            font-size: 28px; 
            font-weight: 900; 
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            word-break: break-word; 
        }
        
        .stat-label { 
            font-size: 11px; 
            color: var(--text-muted); 
            font-weight: 600; 
            text-transform: uppercase; 
            margin-top: 8px;
            letter-spacing: 0.5px;
        }
        
        .country-list { text-align: left; margin-top: 12px; }
        .country-item { 
            display: flex; 
            justify-content: space-between; 
            font-size: 13px; 
            padding: 10px 0; 
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        .country-item:last-child { border: none; }
        .country-item span:first-child { color: var(--text-primary); font-weight: 600; }
        .empty-state { 
            text-align: center; 
            color: var(--text-muted); 
            font-size: 13px; 
            padding: 12px; 
            font-style: italic; 
        }
        
        .dashboard-section { 
            background: var(--bg-card); 
            border-radius: var(--radius-lg); 
            padding: 24px; 
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .dash-header { 
            font-size: 17px; 
            font-weight: 800; 
            margin-bottom: 18px; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 12px;
            color: var(--text-primary);
        }
        
        /* Video List & Menus */
        .video-list-item { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 14px 0; 
            border-bottom: 1px solid var(--border-color);
            position: relative;
            transition: background 0.3s;
        }
        .video-list-item:hover { background: rgba(168, 85, 247, 0.05); }
        
        .video-list-info { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            flex: 1; 
            min-width: 0; 
        }
        
        .mini-thumb { 
            width: 60px; 
            height: 36px; 
            object-fit: cover; 
            border-radius: var(--radius-sm); 
            background: var(--bg-secondary); 
            flex-shrink: 0;
            border: 1px solid var(--border-color);
        }
        
        .v-title { 
            font-size: 14px; 
            font-weight: 600; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
            color: var(--text-primary);
        }
        
        .menu-container { position: relative; }
        .menu-btn { 
            background: none; 
            border: none; 
            padding: 6px; 
            cursor: pointer; 
            color: var(--text-muted); 
            border-radius: 50%; 
            width: 32px; 
            height: 32px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            transition: all 0.3s;
        }
        .menu-btn:hover { 
            background: var(--bg-secondary); 
            color: var(--accent-primary); 
        }
        
        .video-menu-dropdown { 
            position: absolute; 
            right: 0; 
            top: 100%; 
            width: 190px; 
            background: var(--bg-card); 
            border-radius: var(--radius-md); 
            box-shadow: var(--shadow-lg);
            z-index: 10; 
            overflow: hidden; 
            display: none; 
            border: 1px solid var(--border-color);
            margin-top: 4px;
        }
        .video-menu-dropdown.show { display: block; animation: fadeIn 0.2s ease-out; }
        
        .menu-option { 
            width: 100%; 
            padding: 13px 16px; 
            text-align: left; 
            background: none; 
            border: none; 
            font-size: 13px; 
            font-weight: 500; 
            cursor: pointer; 
            color: var(--text-primary); 
            display: flex; 
            align-items: center; 
            gap: 10px;
            transition: background 0.3s;
        }
        .menu-option:hover { background: var(--bg-secondary); }
        .menu-option svg { width: 16px; height: 16px; opacity: 0.7; }
        .menu-option.danger { color: var(--danger); }
        .menu-option.danger:hover { background: rgba(239, 68, 68, 0.1); }
        .menu-option.danger svg { stroke: var(--danger); }

        /* --- Tabs --- */
        .tab-container { 
            display: flex; 
            padding: 6px; 
            background: var(--bg-secondary); 
            border-radius: var(--radius-lg); 
            margin: 20px;
            border: 1px solid var(--border-color);
        }
        
        .tab { 
            flex: 1; 
            text-align: center; 
            padding: 12px; 
            font-weight: 600; 
            color: var(--text-muted); 
            cursor: pointer; 
            z-index: 2; 
            border-radius: var(--radius-md); 
            transition: all 0.3s; 
            font-size: 14px; 
        }
        .tab.active { 
            color: var(--text-primary); 
            background: var(--accent-gradient); 
            box-shadow: var(--shadow-glow);
        }

        /* --- Video Grid --- */
        .video-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 16px; 
            padding: 0 20px; 
        }
        
        .video-card { 
            background: var(--bg-card); 
            border-radius: var(--radius-lg); 
            overflow: hidden; 
            cursor: pointer; 
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            position: relative; 
            aspect-ratio: 16/9; 
            transition: all 0.3s; 
        }
        .video-card:hover { 
            transform: translateY(-6px); 
            box-shadow: var(--shadow-md);
            border-color: var(--accent-primary);
        }
        .video-card:active { transform: translateY(-2px); }
        
        .thumb-container { 
            width: 100%; 
            height: 100%; 
            position: absolute; 
            inset: 0;
            background-color: #1a1f2e;
        }
        .thumb-container img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        
        .video-info { 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            padding: 30px 12px 12px 12px; 
            background: linear-gradient(to top, rgba(10, 14, 39, 0.95) 0%, transparent 100%); 
            z-index: 2; 
        }
        
        .video-title { 
            color: white; 
            font-size: 0.85rem; 
            font-weight: 700; 
            line-height: 1.3; 
            display: -webkit-box; 
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical; 
            overflow: hidden; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.5); 
        }
        
        .duration { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            background: rgba(168, 85, 247, 0.9); 
            backdrop-filter: blur(4px); 
            color: white; 
            padding: 4px 10px; 
            border-radius: var(--radius-sm); 
            font-size: 10px; 
            font-weight: 700; 
            z-index: 3;
            box-shadow: var(--shadow-sm);
        }

        /* --- Player --- */
        #player-wrapper { 
            width: 100%; 
            background: #000; 
            position: sticky; 
            top: 0; 
            z-index: 50; 
            aspect-ratio: 16/9; 
        }
        
        .player-meta { 
            padding: 24px; 
            background: var(--bg-card); 
            border-bottom-left-radius: var(--radius-lg); 
            border-bottom-right-radius: var(--radius-lg); 
            box-shadow: var(--shadow-md);
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            border-top: none;
        }
        .player-meta h2 { font-size: 1.3rem; font-weight: 800; margin-bottom: 8px; }
        .player-meta p { color: var(--text-secondary); line-height: 1.5; }
        
        .section-header { 
            font-size: 1.2rem; 
            font-weight: 800; 
            padding: 0 20px; 
            margin-bottom: 18px; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
        }
        .section-header::before { 
            content: ''; 
            display: block; 
            width: 4px; 
            height: 20px; 
            background: var(--accent-gradient); 
            border-radius: 2px;
            box-shadow: var(--shadow-glow);
        }

        /* --- Age Gate --- */
        #age-gate { 
            position: fixed; 
            inset: 0; 
            background: var(--bg-primary); 
            z-index: 5000; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            padding: 30px; 
            text-align: center; 
        }
        
        .gate-card { 
            background: var(--bg-card); 
            padding: 50px 35px; 
            border-radius: var(--radius-lg); 
            box-shadow: var(--shadow-lg);
            max-width: 380px; 
            width: 100%;
            border: 1px solid var(--border-color);
        }
        .gate-card .logo { 
            font-size: 2.5rem; 
            margin-bottom: 16px; 
        }
        .gate-card p { 
            margin: 20px 0; 
            color: var(--text-secondary); 
            line-height: 1.6; 
        }

        /* --- Ad Overlay --- */
        #ad-view { 
            position: fixed; 
            inset: 0; 
            background: var(--bg-primary); 
            z-index: 6000; 
            display: none; 
        }
        #ad-frame { 
            width: 100%; 
            height: 100%; 
            border: none; 
        }
        
        #ad-control-box {
            position: absolute; 
            top: 24px; 
            right: 24px; 
            z-index: 6100;
            display: flex; 
            align-items: center; 
            justify-content: center;
        }
        
        .ad-circle-btn {
            width: 50px; 
            height: 50px; 
            border-radius: 50%;
            background: rgba(10, 14, 39, 0.8); 
            color: white; 
            border: 2px solid var(--border-color);
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-weight: 800; 
            font-size: 20px; 
            cursor: default;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-md);
        }
        .ad-circle-btn.closable { 
            background: var(--accent-gradient); 
            border-color: var(--accent-primary); 
            cursor: pointer;
            box-shadow: var(--shadow-glow);
        }
        .ad-circle-btn.closable:hover { 
            transform: scale(1.1);
        }
        
        .ad-loader {
            width: 34px; 
            height: 34px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* --- Scrollbar Styling --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { 
            background: var(--accent-primary); 
            border-radius: 4px; 
        }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-secondary); }
    </style>
    
    <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>
</head>
<body>
    <div id="custom-popup">
        <div class="popup-card">
            <div class="popup-icon" id="pop-icon"></div>
            <div class="popup-title" id="pop-title">Notice</div>
            <div class="popup-msg" id="pop-msg">Something happened.</div>
            <div class="popup-actions" id="pop-actions">
                <button class="btn-primary" onclick="app.closePopup()">OK</button>
            </div>
        </div>
    </div>

    <div id="age-gate">
        <div class="gate-card fade-in">
            <div class="logo">AFROWRLD</div>
            <p>Free and Premium Porn Videos & Sex Movies — Porno, XXX, Porn Tube and Leaks.</p>
            <button class="btn-primary" onclick="app.dismissAgeGate()">I AM 18+ – ENTER</button>
        </div>
    </div>

    <div id="ad-view">
        <div id="ad-control-box">
            <!-- Content Injected via JS -->
        </div>
        <iframe id="ad-frame"></iframe>
    </div>

    <header id="main-header">
        <div class="logo">AFROWRLD</div>
        <button class="icon-btn" onclick="app.navigateTo('admin-login')">
            <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        </button>
    </header>

    <main id="home-view" class="view active">
        <div class="tab-container">
            <div class="tab active" onclick="app.switchTab('trending')">Trending</div>
            <div class="tab" onclick="app.switchTab('highlights')">Highlights</div>
        </div>
        <div id="video-grid" class="video-grid fade-in"></div>
    </main>

    <div id="player-view" class="view">
        <div class="nav-bar">
            <button class="back-link" onclick="app.handleBack()">
                <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"><polyline points="15 18 9 12 15 6"></polyline></svg> Back
            </button>
        </div>
        <div id="player-wrapper">
            <video id="fluid-player" style="width: 100%; height: 100%;" type="video/mp4"></video>
        </div>
        <div class="player-meta">
            <h2 id="player-title"></h2>
            <p id="player-desc" style="margin-top:8px;"></p>
        </div>
        <div class="section-header">Related Videos</div>
        <div id="related-grid" class="video-grid"></div>
    </div>

    <div id="admin-login" class="view">
        <div class="nav-bar">
            <button class="back-link" onclick="app.handleBack()">
                <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"><polyline points="15 18 9 12 15 6"></polyline></svg> Back
            </button>
        </div>
        <div class="container fade-in">
            <h2 style="text-align: center; margin-top: 40px; margin-bottom: 24px; font-size: 1.8rem;">Sign in to your account</h2>
            <div class="admin-form">
                <div class="input-group">
                    <span class="input-label">Username</span>
                    <input type="text" id="admin-user" placeholder="Enter username">
                </div>
                <div class="input-group">
                    <span class="input-label">Password</span>
                    <div style="position:relative; width:100%;">
                        <input type="password" id="admin-pass" placeholder="Enter password">
                        <button class="password-toggle" onclick="app.togglePassVisibility()">
                            <svg id="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        </button>
                    </div>
                </div>
                <button class="btn-primary" onclick="app.loginAdmin()">Login</button>
            </div>
        </div>
    </div>

    <div id="admin-dashboard" class="view">
        <div class="nav-bar">
            <button class="back-link" onclick="app.handleBack()">
                <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"><polyline points="15 18 9 12 15 6"></polyline></svg> Logout
            </button>
        </div>
        <div class="container fade-in" style="padding-top: 24px;">
            <h1 style="margin-bottom: 24px; font-size: 1.8rem;">Dashboard</h1>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-num" id="stat-views">0</div>
                    <div class="stat-label">Total Views</div>
                </div>
                <div class="stat-card">
                    <div class="stat-num" id="stat-watch">0m</div>
                    <div class="stat-label">Watch Time</div>
                </div>
                <div class="stat-card" style="grid-column: span 2; text-align: left;">
                    <div style="font-size: 15px; font-weight:800; color:var(--text-primary); margin-bottom:8px;">Top Countries</div>
                    <div id="stat-countries-list" class="country-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <div class="dashboard-section">
                <div class="dash-header">Ad Settings</div>
                <div class="input-group">
                    <span class="input-label">Ad Direct Link</span>
                    <input type="text" id="ad-url-input" placeholder="https://...">
                    <button class="btn-primary" style="margin-top:14px; padding: 12px;" onclick="app.saveAdSettings()">Save Changes</button>
                </div>
            </div>

            <div class="dashboard-section">
                <div class="dash-header" style="display:flex; justify-content:space-between; align-items:center;">
                    <span>Video Library</span>
                    <button class="btn-primary" style="width: auto; padding: 8px 18px; font-size: 13px;" onclick="app.navigateTo('admin-upload')">+ New Video</button>
                </div>
                <div id="admin-video-list"></div>
            </div>
        </div>
    </div>

    <div id="admin-upload" class="view">
        <div class="nav-bar">
            <button class="back-link" onclick="app.handleBack()">
                <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor"><polyline points="15 18 9 12 15 6"></polyline></svg> Back
            </button>
        </div>
        <div class="container fade-in">
            <h2 style="text-align: center; margin-top: 30px; font-size: 1.6rem;">Upload Content</h2>
            <div class="admin-form">
                <div class="input-group">
                    <span class="input-label">Video Title</span>
                    <input type="text" id="vid-title" placeholder="e.g. Crazy Goal">
                </div>
                
                <div class="input-group">
                    <span class="input-label">Category</span>
                    <select id="vid-category">
                        <option value="trending">Trending</option>
                        <option value="highlights">Highlights</option>
                    </select>
                </div>

                <div class="input-group">
                    <span class="input-label">Meta Description</span>
                    <textarea id="vid-desc" placeholder="Enter video description..."></textarea>
                </div>

                <div class="input-group">
                    <span class="input-label">Video File</span>
                    <input type="file" id="vid-file" accept="video/*">
                </div>

                <p id="upload-status" style="font-size: 14px; color: var(--accent-primary); text-align: center; font-weight: 600;"></p>
                <button class="btn-primary" onclick="app.handleUpload()">Upload Video</button>
            </div>
        </div>
    </div>

    <script>
        // --- SECURE CONFIG ---
        // SHA-256 Hash of 'admin123' to prevent plain text password
        const PASS_HASH = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9"; 
        
        // --- STATE MANAGEMENT WITH LOCAL STORAGE ---
        const DEFAULT_DB = {
            trending: [
                { id: 1, title: "Insane Bicycle Kick Goal 2024", category: "trending", desc: "One of the best goals of the season!", duration: "0:45", thumb: "https://images.unsplash.com/photo-1579952363873-27f3bde9be2e?w=600", url: "https://www.w3schools.com/html/mov_bbb.mp4", views: 120, watchTime: 450 },
                { id: 2, title: "Lakers vs Warriors Final Minute", category: "trending", desc: "Intense final moments.", duration: "2:30", thumb: "https://images.unsplash.com/photo-1546519638-68e109498ffc?w=600", url: "https://www.w3schools.com/html/movie.mp4", views: 85, watchTime: 1200 }
            ],
            highlights: [
                { id: 5, title: "Best Tennis Rally Ever", category: "highlights", desc: "You won't believe this rally.", duration: "3:05", thumb: "https://images.unsplash.com/photo-1622279457486-62dcc4a431d6?w=600", url: "https://www.w3schools.com/html/mov_bbb.mp4", views: 40, watchTime: 300 }
            ]
        };

        // Load DB from Storage or use Default
        let DB = JSON.parse(localStorage.getItem('bunhub_db')) || DEFAULT_DB;

        // Load Config from Storage
        let CONFIG = JSON.parse(localStorage.getItem('bunhub_config')) || {
            adLink: "https://rebrandlink.com/dl/420335",
            adDuration: 5,
            loadDuration: 2
        };

        // Load Stats from Storage (Start Countries Empty)
        let STATS = JSON.parse(localStorage.getItem('bunhub_stats')) || {
            totalViews: 0,
            totalWatchSeconds: 0,
            countries: {} // Initial nil state
        };

        const app = {
            currentTab: 'trending',
            currentView: 'home-view',
            history: [],
            adActive: false,
            adClosable: false,
            adShownThisSession: false,
            fluidInstance: null,
            adTimerInterval: null,
            currentVideoId: null,

            init: function() {
    // 1. Render content IMMEDIATELY
    app.renderGrid();

    // 2. Handle Telegram stuff asynchronously
    if (window.Telegram && window.Telegram.WebApp) {
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
        window.Telegram.WebApp.BackButton.onClick(app.handleBack);
        this.requestBotPermissions();
    }
                
                // Track Current Country Automatically
                try {
                    const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    const region = timeZone.split('/')[1] || "Unknown";
                    if(!STATS.countries[region]) STATS.countries[region] = 0;
                    STATS.countries[region]++;
                    this.saveData();
                } catch(e) { console.log("Timezone detect error"); }

                app.renderGrid();
                
                // Click outside to close menus
                window.onclick = function(event) {
                    if (!event.target.matches('.menu-btn') && !event.target.closest('.menu-btn')) {
                        document.querySelectorAll('.video-menu-dropdown').forEach(d => d.classList.remove('show'));
                    }
                }
            },

            requestBotPermissions: function() {
                if (window.Telegram && window.Telegram.WebApp.requestWriteAccess) {
                    window.Telegram.WebApp.requestWriteAccess((allowed) => {
                        if (allowed) console.log("Permission granted");
                    });
                }
            },

            saveData: function() {
                localStorage.setItem('bunhub_db', JSON.stringify(DB));
                localStorage.setItem('bunhub_stats', JSON.stringify(STATS));
                localStorage.setItem('bunhub_config', JSON.stringify(CONFIG));
            },

            // --- UI HELPERS ---
            showPopup: function(title, msg, iconSvg, action=null) {
                document.getElementById('pop-title').innerText = title;
                document.getElementById('pop-msg').innerText = msg;
                document.getElementById('pop-icon').innerHTML = iconSvg;
                
                const btnContainer = document.getElementById('pop-actions');
                btnContainer.innerHTML = '';
                
                if (action) {
                    const btn = document.createElement('button');
                    btn.className = 'btn-primary';
                    btn.innerText = "Confirm";
                    btn.onclick = () => { action(); app.closePopup(); };
                    
                    const cancel = document.createElement('button');
                    cancel.className = 'btn-primary btn-outline';
                    cancel.innerText = "Cancel";
                    cancel.onclick = app.closePopup;
                    
                    btnContainer.appendChild(btn);
                    btnContainer.appendChild(cancel);
                } else {
                    const btn = document.createElement('button');
                    btn.className = 'btn-primary';
                    btn.innerText = "OK";
                    btn.onclick = app.closePopup;
                    btnContainer.appendChild(btn);
                }

                document.getElementById('custom-popup').style.display = 'flex';
            },

            closePopup: function() {
                document.getElementById('custom-popup').style.display = 'none';
            },

            dismissAgeGate: function() {
                document.getElementById('age-gate').style.display = 'none';
                app.updateBackButton();
            },

            // --- NAVIGATION ---
            navigateTo: function(viewId) {
                if (this.currentView === 'player-view' && viewId !== 'player-view') this.destroyPlayer();
                if (viewId === 'admin-dashboard') app.renderAdminDashboard();
                
                this.history.push(this.currentView);
                this.switchViewInternal(viewId);
            },

            switchViewInternal: function(viewId) {
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.getElementById(viewId).classList.add('active');
                this.currentView = viewId;
                
                const hideHeader = ['player-view', 'admin-login', 'admin-upload', 'admin-dashboard'].includes(viewId);
                document.getElementById('main-header').style.display = hideHeader ? 'none' : 'flex';
                
                this.updateBackButton();
                window.scrollTo(0,0);
            },

            handleBack: function() {
                if (app.adActive) {
                    if (app.adClosable) app.closeAd();
                    return;
                }
                if (app.currentView === 'home-view') {
                    if (window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.close();
                    return;
                }
                if (app.history.length > 0) {
                    const prevView = app.history.pop();
                    if (app.currentView === 'player-view') app.destroyPlayer();
                    
                    if (app.currentView === 'admin-dashboard') {
                        document.getElementById('admin-user').value = '';
                        document.getElementById('admin-pass').value = '';
                        app.switchViewInternal('home-view');
                    } else {
                        app.switchViewInternal(prevView);
                    }
                } else {
                    app.switchViewInternal('home-view');
                }
            },

            updateBackButton: function() {
                if (window.Telegram && window.Telegram.WebApp) {
                    app.currentView === 'home-view' ? window.Telegram.WebApp.BackButton.hide() : window.Telegram.WebApp.BackButton.show();
                }
            },

            // --- GRID & PLAYER ---
            switchTab: function(tab) {
                this.currentTab = tab;
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                event.target.classList.add('active');
                this.renderGrid();
            },

            renderGrid: function() {
                const grid = document.getElementById('video-grid');
                grid.innerHTML = '';
                
                if (!DB[this.currentTab]) DB[this.currentTab] = [];
                
                DB[this.currentTab].forEach(vid => {
                    const card = document.createElement('div');
                    card.className = 'video-card';
                    card.onclick = () => app.loadPlayer(vid);
                    card.innerHTML = `
                        <div class="thumb-container"><img src="${vid.thumb}"><div class="duration">${vid.duration}</div></div>
                        <div class="video-info"><div class="video-title">${vid.title}</div></div>
                    `;
                    grid.appendChild(card);
                });
            },

            resetPlayerDOM: function() {
                const wrapper = document.getElementById('player-wrapper');
                wrapper.innerHTML = ''; // Clear old instance
                const newVideo = document.createElement('video');
                newVideo.id = 'fluid-player';
                newVideo.style.width = '100%';
                newVideo.style.height = '100%';
                newVideo.type = 'video/mp4';
                wrapper.appendChild(newVideo);
            },

            loadPlayer: function(vid) {
                this.currentVideoId = vid.id;
                this.adShownThisSession = false;
                
                STATS.totalViews++;
                if(!vid.views) vid.views = 0;
                vid.views++;
                this.saveData();

                this.navigateTo('player-view');
                document.getElementById('player-title').innerText = vid.title;
                document.getElementById('player-desc').innerText = vid.desc || "Action • Sports";
                
                // FIX: Refresh Player DOM to prevent black screen on return
                this.resetPlayerDOM();

                const videoEl = document.getElementById('fluid-player');
                videoEl.src = vid.url;

                if (this.fluidInstance) this.fluidInstance.destroy();

                this.fluidInstance = fluidPlayer('fluid-player', {
                    layoutControls: { primaryColor: "#a855f7", fillToContainer: true, autoPlay: false, allowDownload: false }
                });

                this.fluidInstance.on('play', function() {
                    if (!app.adShownThisSession) {
                        app.fluidInstance.pause();
                        app.triggerAdSequence();
                    }
                });

                this.fluidInstance.on('timeupdate', function(time) {
                    if(Math.floor(time) % 5 === 0) {
                        STATS.totalWatchSeconds += 0.2; 
                        if(vid.watchTime === undefined) vid.watchTime = 0;
                        vid.watchTime += 0.2;
                        app.saveData();
                    }
                });

                this.renderRelated(vid.id);
            },

            renderRelated: function(currentId) {
                const grid = document.getElementById('related-grid');
                grid.innerHTML = '';
                const allVids = [...DB.trending, ...DB.highlights].filter(v => v.id !== currentId);
                const shuffled = allVids.sort(() => 0.5 - Math.random()).slice(0, 4); 

                shuffled.forEach(vid => {
                    const card = document.createElement('div');
                    card.className = 'video-card';
                    card.onclick = () => app.loadPlayer(vid);
                    card.innerHTML = `
                        <div class="thumb-container"><img src="${vid.thumb}"><div class="duration">${vid.duration}</div></div>
                        <div class="video-info"><div class="video-title">${vid.title}</div></div>
                    `;
                    grid.appendChild(card);
                });
            },

            destroyPlayer: function() {
                if (this.fluidInstance) {
                    this.fluidInstance.destroy();
                    this.fluidInstance = null;
                }
            },

            // --- AD SEQUENCE ---
            triggerAdSequence: function() {
                this.adActive = true;
                this.adClosable = false;
                
                const adView = document.getElementById('ad-view');
                const controlBox = document.getElementById('ad-control-box');
                const frame = document.getElementById('ad-frame');
                
                adView.style.display = 'block';
                frame.src = CONFIG.adLink;

                controlBox.innerHTML = '<div class="ad-loader"></div>';
                
                setTimeout(() => {
                    let timeLeft = CONFIG.adDuration;
                    const updateTimer = () => { controlBox.innerHTML = `<div class="ad-circle-btn">${timeLeft}</div>`; };
                    updateTimer();

                    this.adTimerInterval = setInterval(() => {
                        timeLeft--;
                        if (timeLeft > 0) {
                            updateTimer();
                        } else {
                            clearInterval(this.adTimerInterval);
                            app.adClosable = true;
                            controlBox.innerHTML = `<div class="ad-circle-btn closable" onclick="app.closeAd()">✕</div>`;
                        }
                    }, 1000);

                }, CONFIG.loadDuration * 1000);
            },

            closeAd: function() {
                clearInterval(this.adTimerInterval);
                document.getElementById('ad-view').style.display = 'none';
                document.getElementById('ad-frame').src = ''; 
                this.adActive = false;
                this.adShownThisSession = true;
                if (this.fluidInstance) this.fluidInstance.play();
            },

            // --- ADMIN AUTH ---
            togglePassVisibility: function() {
                const input = document.getElementById('admin-pass');
                const icon = document.getElementById('eye-icon');
                if (input.type === "password") {
                    input.type = "text";
                    icon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
                } else {
                    input.type = "password";
                    icon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
                }
            },

            async sha256(message) {
                const msgBuffer = new TextEncoder().encode(message);
                const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            },

            loginAdmin: async function() {
                const user = document.getElementById('admin-user').value;
                const pass = document.getElementById('admin-pass').value;
                const hash = await this.sha256(pass);

                if(user === "admin" && hash === PASS_HASH) {
                    this.navigateTo('admin-dashboard');
                } else {
                    app.showPopup("Access Denied", "Incorrect Username or Password", '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="stroke:var(--danger)"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>');
                }
            },

            // --- DASHBOARD ---
            renderAdminDashboard: function() {
                document.getElementById('stat-views').innerText = STATS.totalViews;
                const minutes = Math.floor(STATS.totalWatchSeconds / 60);
                document.getElementById('stat-watch').innerText = minutes + "m";
                document.getElementById('ad-url-input').value = CONFIG.adLink;
                
                const sortedCountries = Object.entries(STATS.countries).sort((a,b) => b[1] - a[1]).slice(0, 5);
                const countryList = document.getElementById('stat-countries-list');
                countryList.innerHTML = '';
                
                if(sortedCountries.length === 0) {
                    countryList.innerHTML = '<div class="empty-state">No location data yet</div>';
                } else {
                    sortedCountries.forEach(([code, count]) => {
                        countryList.innerHTML += `<div class="country-item"><span>${code}</span><span>${count} views</span></div>`;
                    });
                }

                const list = document.getElementById('admin-video-list');
                list.innerHTML = '';
                const allVideos = [...DB.trending, ...DB.highlights];

                allVideos.forEach(vid => {
                    const item = document.createElement('div');
                    item.className = 'video-list-item';
                    item.innerHTML = `
                        <div class="video-list-info">
                            <img src="${vid.thumb}" class="mini-thumb">
                            <div class="v-title">${vid.title}</div>
                        </div>
                        <div class="menu-container">
                            <button class="menu-btn" onclick="app.toggleMenu(event, ${vid.id})">
                                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                            </button>
                            <div id="menu-${vid.id}" class="video-menu-dropdown">
                                <button class="menu-option" onclick="app.viewAnalytics(${vid.id})">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg> Analytics
                                </button>
                                <button class="menu-option" onclick="app.editTitle(${vid.id})">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg> Edit Title
                                </button>
                                <button class="menu-option danger" onclick="app.deleteVideo(${vid.id})">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg> Delete
                                </button>
                            </div>
                        </div>
                    `;
                    list.appendChild(item);
                });
            },

            toggleMenu: function(e, id) {
                e.stopPropagation();
                document.querySelectorAll('.video-menu-dropdown').forEach(d => {
                    if(d.id !== `menu-${id}`) d.classList.remove('show');
                });
                document.getElementById(`menu-${id}`).classList.toggle('show');
            },

            deleteVideo: function(id) {
                app.showPopup("Delete Video?", "This action cannot be undone.", '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="stroke:var(--danger)"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>', () => {
                    DB.trending = DB.trending.filter(v => v.id !== id);
                    DB.highlights = DB.highlights.filter(v => v.id !== id);
                    app.saveData();
                    app.renderAdminDashboard();
                    app.renderGrid();
                });
            },

            editTitle: function(id) {
                const vid = [...DB.trending, ...DB.highlights].find(v => v.id === id);
                if(vid) {
                    const newTitle = prompt("New Title:", vid.title);
                    if(newTitle) {
                        vid.title = newTitle;
                        app.saveData();
                        app.renderAdminDashboard();
                        app.renderGrid();
                    }
                }
            },

            viewAnalytics: function(id) {
                const vid = [...DB.trending, ...DB.highlights].find(v => v.id === id);
                if(vid) {
                    const m = Math.floor((vid.watchTime || 0) / 60);
                    app.showPopup("Video Analytics", `"${vid.title}"\n\nViews: ${vid.views || 0}\nWatch Time: ${m} mins`, '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="stroke:var(--accent-primary)"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>');
                }
            },

            saveAdSettings: function() {
                const url = document.getElementById('ad-url-input').value;
                if(url) {
                    CONFIG.adLink = url;
                    app.saveData();
                    app.showPopup("Success", "Ad Link updated for all users.", '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="stroke:var(--success)"><polyline points="20 6 9 17 4 12"/></svg>');
                }
            },

            handleUpload: async function() {
                const titleInput = document.getElementById('vid-title');
                const catInput = document.getElementById('vid-category');
                const descInput = document.getElementById('vid-desc');
                const fileInput = document.getElementById('vid-file');
                const status = document.getElementById('upload-status');

                if(!titleInput.value || !fileInput.files[0]) return app.showPopup("Error", "Please fill all fields.", '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="stroke:var(--danger)"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>');

                status.innerText = "Processing video...";
                const file = fileInput.files[0];
                const url = URL.createObjectURL(file);
                
                const thumb = await app.generateThumbnail(url);
                
                const newVid = { 
                    id: Date.now(), 
                    title: titleInput.value, 
                    category: catInput.value,
                    desc: descInput.value,
                    duration: "New", 
                    thumb: thumb, 
                    url: url, 
                    views: 0, 
                    watchTime: 0 
                };

                DB[catInput.value].unshift(newVid);
                app.saveData();
                
                status.innerText = "Upload Successful!";
                setTimeout(() => {
                    status.innerText = "";
                    // Clear Form
                    titleInput.value = "";
                    descInput.value = "";
                    fileInput.value = "";
                    app.navigateTo('admin-dashboard');
                }, 1000);
            },

            generateThumbnail: function(videoUrl) {
                return new Promise((resolve) => {
                    const video = document.createElement('video');
                    video.src = videoUrl; video.muted = true; video.currentTime = 1; 
                    video.onloadeddata = () => {
                        setTimeout(() => {
                            const canvas = document.createElement('canvas');
                            canvas.width = 640; canvas.height = 360;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                            resolve(canvas.toDataURL('image/jpeg'));
                        }, 500);
                    };
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
